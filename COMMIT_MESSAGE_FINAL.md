# refactor: –£–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞

–í—ã–ø–æ–ª–Ω–µ–Ω—ã –∑–∞–¥–∞—á–∏ "–ù–µ–¥–µ–ª–∏ 1" –∏–∑ –ø–ª–∞–Ω–∞ —É–ª—É—á—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏—Ä–∞:
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã ChunkUtils –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Web Workers (–æ—Ç–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (30 –º–∏–Ω)

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:**
- `src/constants/WorldConstants.ts` - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/world/generation/TerrainGenerator.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `WORLD_GENERATION` –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `src/world/generation/StructureGenerator.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –¥–µ—Ä–µ–≤—å–µ–≤ –∏ —Ä—É–¥
- `src/world/chunks/ChunkManager.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —á–∞–Ω–∫–æ–≤ –∏ –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏
- `src/world/workers/terrain.worker.ts` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –≥–ª–∞–≤–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º

**–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
- Terrain: `TERRAIN_SCALE`, `TERRAIN_HEIGHT`, `BASE_HEIGHT`
- Chunks: `CHUNK_SIZE`, `CHUNK_HEIGHT`, `CHUNK_RADIUS`
- Updates: `UPDATE_INTERVAL`, `MEMORY_CLEANUP_CHANCE_*`
- Structures: `TREE_CHANCE`, `TREE_MIN_HEIGHT`, `TREE_MAX_HEIGHT`
- Ores: `COAL_VEIN_SIZE`, `COAL_ATTEMPTS`, `IRON_VEIN_SIZE`, `IRON_ATTEMPTS`
- Workers: `USE_WEB_WORKERS`, `WORKER_POOL_SIZE`

### 2. –£—Ç–∏–ª–∏—Ç–∞ ChunkUtils (15 –º–∏–Ω)

**–ù–æ–≤—ã–π —Ñ–∞–π–ª:**
- `src/utils/ChunkUtils.ts` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞–Ω–∫–∞–º–∏

**–§—É–Ω–∫—Ü–∏–∏:**
- `getBlockIndex(x, y, z, chunkSize, chunkHeight)` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–¥–µ–∫—Å –±–ª–æ–∫–∞ –≤ –º–∞—Å—Å–∏–≤–µ
- `chunkToWorld(cx, cz, chunkSize)` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–∞–Ω–∫–∞ –≤ –º–∏—Ä–æ–≤—ã–µ
- `worldToChunk(x, z, chunkSize)` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–∞–Ω–∫–∞
- `createBlockIndexGetter(chunkSize, chunkHeight)` - —Å–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/world/chunks/ChunkLoader.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Ç–∏–ª–∏—Ç—ã –∏–∑ ChunkUtils
- `src/world/chunks/ChunkDataManager.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getBlockIndex`
- `src/world/chunks/ChunkGenerationQueue.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `createBlockIndexGetter`
- `src/world/workers/terrain.worker.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getBlockIndex`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `getBlockIndex` –≤ 5 —Ñ–∞–π–ª–∞—Ö

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Web Workers (—É–∂–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–Ω–µ–µ)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`USE_WEB_WORKERS: false`)

**–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:**
- –¢–µ–∫—É—â–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±—ã—Å—Ç—Ä–∞—è (10-20ms –Ω–∞ —á–∞–Ω–∫)
- –í–æ—Ä–∫–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–∑-–∑–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ–π (>50ms) –∏–∑-–∑–∞ –±–∏–æ–º–æ–≤, –ø–µ—â–µ—Ä, —Å—Ç—Ä—É–∫—Ç—É—Ä
- –†–∞–¥–∏—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ 8-10 —á–∞–Ω–∫–æ–≤
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —á–∞–Ω–∫–æ–≤

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `doc/WEB_WORKERS_INTEGRATION.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
- `TESTING_WEB_WORKERS.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç:**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–µ–≥–∫–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –≥–ª–∞–≤–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º –∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏

‚úÖ **ChunkUtils:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –£–ª—É—á—à–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

‚úÖ **Web Workers:**
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –û—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –õ–µ–≥–∫–æ –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- –ù–µ—Ç –æ—à–∏–±–æ–∫ TypeScript
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- `TODO_WORLD_GENERATION.md` - –æ—Ç–º–µ—á–µ–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `doc/WEB_WORKERS_INTEGRATION.md` - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ Web Workers
- `doc/WORLD_GENERATION_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `doc/WORLD_GENERATION_IMPROVEMENTS.md` - –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π
- `doc/GREEDY_MESHING_EXPLAINED.md` - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ Greedy Meshing

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–ù–µ–¥–µ–ª—è 2:** –°–∏—Å—Ç–µ–º–∞ –±–∏–æ–º–æ–≤ (8-12 —á–∞—Å–æ–≤)
- –î–æ–±–∞–≤–∏—Ç—å 5 –±–∏–æ–º–æ–≤ (Plains, Desert, Forest, Mountains, Snow)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 2D noise –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏ (Sand, Snow, Cactus)

**–ù–µ–¥–µ–ª—è 3:** –£–ª—É—á—à–µ–Ω–Ω—ã–π Face Culling (2-3 —á–∞—Å–∞)
- –û—Ç—Å–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–µ–π –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —á–∞–Ω–∫–æ–≤
- –û—Ç—Å–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç—ã—Ö –±–ª–æ–∫–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å–æ—Å–µ–¥–µ–π

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç: ~30 –º–∏–Ω—É—Ç
- –£—Ç–∏–ª–∏—Ç–∞ ChunkUtils: ~15 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ:** ~45 –º–∏–Ω—É—Ç (–±—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã)

---

**–°—Ç–∞—Ç—É—Å –ù–µ–¥–µ–ª–∏ 1:** ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
